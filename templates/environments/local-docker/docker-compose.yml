version: '3.7'

services:
  {% for service in services %}
  {{service.name}}:
    {% if service.env_files %}
    env_file:
      {% for envfile in service.env_files %}
      - {{envfile}}
      {% endfor %}
    {% endif %}
    build:
      context: {{service.path}}
      dockerfile: {{service.dockerfile}}
    volumes:
      - type: bind
        source: {{service.path}}
        target: /code
    {% if service.dependencies %}
    depends_on:
      {% for dep in service.dependencies %}
      - {{dep}}
      {% endfor %}
    {% endif %}
    restart: always
    image: {{service.name}}
    ports:
      - {{service.port}}
    {% if service.command %}
    command: {{service.command}}
    {% endif %}
  {% endfor %}
